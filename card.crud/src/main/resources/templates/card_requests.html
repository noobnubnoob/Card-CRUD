<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Card Request Manager</title>
    <meta charset="UTF-8">
    <style>
        table, th, td { border: 1px solid black; border-collapse: collapse; padding: 8px; }
        input { margin: 4px; }
        button { margin-left: 6px; }
    </style>
</head>
<body>
<h1>Card Request Manager</h1>

<div>
    <label for="oib">OIB:</label>
    <input type="text" id="oib" name="oib">
    <button onclick="findCardRequests()">Find</button>
    <button onclick="deleteCardRequests()">Delete</button>
</div>

<div id="resultsSection" style="margin-top: 20px;">
    <h3>Results:</h3>
    <table id="resultsTable">
        <thead>
        <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Status</th>
            <th>OIB</th>
        </tr>
        </thead>
        <tbody id="resultsBody">
        </tbody>
    </table>
</div>

<!-- Add New Card Request -->
<div style="margin-top: 30px;">
    <h3>Create New Card Request</h3>
    <form id="createForm" onsubmit="createCardRequest(event)">
        <table>
            <tr>
                <td><input type="text" name="firstName" placeholder="First Name" required></td>
                <td><input type="text" name="lastName" placeholder="Last Name" required></td>
                <td><input type="text" name="status" placeholder="Status" required></td>
                <td><input type="text" name="oib" placeholder="OIB" required></td>
                <td><button type="submit">Create</button></td>
            </tr>
        </table>
    </form>
</div>

<script>
    function findCardRequests() {
        const oib = document.getElementById("oib").value;
        fetch(`/api/v1/client-cards/${oib}`)
            .then(response => {
                if (!response.ok) throw new Error("Not found");
                return response.json();
            })
            .then(data => {
                const tbody = document.getElementById("resultsBody");
                tbody.innerHTML = ""; // Clear old results
                data.forEach(card => {
                    const row = `<tr>
                        <td>${card.firstName}</td>
                        <td>${card.lastName}</td>
                        <td>${card.status}</td>
                        <td>${card.oib}</td>
                    </tr>`;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
            })
            .catch(err => {
                alert("No card requests found for given OIB.");
            });
    }

    
</script>
</body>
</html>
